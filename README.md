# reactivity_lessons

## 2025 IThome articles

- å°ˆæ¡ˆå…§çš„ Lesson ä»£è™Ÿæœƒå°æ‡‰ signal å¯¦ä½œé–‹å§‹çš„ç’°ç¯€
- æ¯å€‹ Lesson ä»£è™Ÿæœƒå°æ‡‰ä¸Šä¸€ç« ç¯€çš„ code å¾€ä¸‹å»¶ä¼¸ï¼Œæ–¹ä¾¿è®€è€…é–±è®€
- æ ¸å¿ƒçš„éƒ¨åˆ†èˆ‡éµäººè³½æ–‡ç« å…§çš„è¨­å®šæ˜¯ç›¸åŒçš„ï¼Œé€™ç³»åˆ—ä»¥æ•™å­¸ç‚ºä¸»ï¼Œæ‰€ä»¥è¦è½‰ç‚º production ä½¿ç”¨çš„è©±ï¼Œè¦è€ƒæ…®è³‡æ–™çµæ§‹èˆ‡è¨˜æ†¶é«”é‡‹æ”¾çš„å•é¡Œ

## Lesson 1: signal basic

é€éç°¡å–®çš„ "é–‰åŒ… + è§£æ§‹" æŠ€å·§ï¼Œå»ºæ§‹åŸºæœ¬èƒ½å¤ æš«å­˜çš„å–®å…ƒ  
ğŸ‘‰ [æ–‡ç« é€£çµ](https://ithelp.ithome.com.tw/articles/10374051)

## Lesson 2: signal with subscribe

å°æ‡‰ç³»åˆ—æ–‡ç« ä¸­ï¼ŒåŠ ä¸Šè¨‚é–±æ©Ÿåˆ¶çš„æ‡‰ç”¨  
ğŸ‘‰ [æ–‡ç« é€£çµ](https://ithelp.ithome.com.tw/articles/10374070)

## Lesson 3: effect symbol

å°æ‡‰ç³»åˆ—æ–‡ç« ä¸­ï¼ŒEffect å¯¦ä½œçš„åˆæ­¥è¬›è§£  
ğŸ‘‰ [æ–‡ç« é€£çµ](https://ithelp.ithome.com.tw/articles/10374158)

## Lesson 4: effect weakmap

å°æ‡‰ç³»åˆ—æ–‡ç« ä¸­ï¼ŒEffect é¸å‹çš„è¬›è§£  
ğŸ‘‰ [æ–‡ç« é€£çµ](https://ithelp.ithome.com.tw/articles/10374388)

## Lesson 5: computed

å°æ‡‰ç³»åˆ—æ–‡ç« ä¸­ï¼Œcomputed å¯¦ä½œç« ç¯€  
ğŸ‘‰ [æ–‡ç« é€£çµ](https://ithelp.ithome.com.tw/articles/10374474)

## Lesson 6: batch

å°æ‡‰ç³»åˆ—æ–‡ç« ä¸­ï¼Œbatch & transaction çš„è¬›è§£  
ğŸ‘‰ [æ–‡ç« é€£çµ](https://ithelp.ithome.com.tw/articles/10374497)

## Lesson 7: react case

å°æ‡‰ç³»åˆ—æ–‡ç« ä¸­ï¼ŒReact æ‡‰ç”¨çš„å…§å®¹  
ğŸ‘‰ [å°æ‡‰ React (I)](https://ithelp.ithome.com.tw/articles/10374805)  
ğŸ‘‰ [å°æ‡‰ React (II)](https://ithelp.ithome.com.tw/articles/10374827)  
ğŸ‘‰ [å°æ‡‰ React (III)](https://ithelp.ithome.com.tw/articles/10374977)  
ğŸ‘‰ [å°æ‡‰ React (IV)](https://ithelp.ithome.com.tw/articles/10375129)  
ğŸ‘‰ [å°æ‡‰ React (V)](https://ithelp.ithome.com.tw/articles/10375334)  
ğŸ‘‰ [å°æ‡‰ React (VI)](https://ithelp.ithome.com.tw/articles/10375381)

## Lesson 8: vue case

å°æ‡‰ç³»åˆ—æ–‡ç« ä¸­ï¼Œvue æ‡‰ç”¨çš„å…§å®¹  
ğŸ‘‰ [å°æ‡‰ Vue (I)](https://ithelp.ithome.com.tw/articles/10375400)  
ğŸ‘‰ [å°æ‡‰ Vue (II)](https://ithelp.ithome.com.tw/articles/10375747)

## Lesson 9: transaction async

å°æ‡‰ç³»åˆ—æ–‡ç« ä¸­ï¼Œé€²éšå…§æ ¸æ¢è¨çš„ async transaction è­°é¡Œ  
ğŸ‘‰ [æ–‡ç« é€£çµ](https://ithelp.ithome.com.tw/articles/10375779)

## Lesson 10: atomic transaction

å°æ‡‰ç³»åˆ—æ–‡ç« ä¸­ï¼Œé€²éšå…§æ ¸æ¢è¨çš„åŸå­äº¤æ˜“  
ğŸ‘‰ [æ–‡ç« é€£çµ](https://ithelp.ithome.com.tw/articles/10375799)

## Lesson 11: scheduler adv

å°æ‡‰ç³»åˆ—æ–‡ç« ä¸­ï¼Œé€²éšå…§æ ¸æ¢è¨çš„ scheduler é€²éšè­°é¡Œ  
ğŸ‘‰ [æ–‡ç« é€£çµ](https://ithelp.ithome.com.tw/articles/10376293)

## Lesson 12: devtools

å°æ‡‰ç³»åˆ—æ–‡ç« ä¸­ï¼Œé€²éšå…§æ ¸å¯¦ä½œçš„ç°¡æ˜“ Devtools  
ğŸ‘‰ [æ–‡ç« é€£çµ](https://ithelp.ithome.com.tw/articles/10376469)

## Lesson 13: two-phase flush

é¡å¤–è£œå……ç‰½æ¶‰åˆ° Scheduler è™•è£¡æ’ç¨‹æœƒé‡åˆ°çš„å„ªå…ˆé †åºè­°é¡Œï¼Œé€™è£¡å°æ‡‰çš„è§£æ³•å°±æ˜¯ "æ‰¹æ¬¡ + å„ªå…ˆç´š" çš„æ–¹å¼ã€‚

### Two-phase flush flow chart

```mermaid
flowchart TD
  A["é–‹å§‹ flushJobsTwoPhase()"] --> B{computeQ èˆ‡ effectQ éƒ½ç‚ºç©º?}
  B -- æ˜¯ --> Z[çµæŸ return]
  B -- å¦ --> C[scheduled = false]

  C --> D{computeQ ç‚ºç©º?}
  D -- å¦ --> E[å–å‡ºä¸€æ‰¹ computeQ]
  E --> F["é€å€‹ job.run()<br/>å¯èƒ½ enqueue æ–°çš„ computed/effect"]
  F --> D
  D -- æ˜¯ --> G[é€²å…¥ Phase B]

  G --> H{effectQ ç‚ºç©º?}
  H -- å¦ --> I["æŒ‰ priority(å°â†’å¤§) æ’åº effectQ"]
  I --> J["é€å€‹ effect.run()<br/>å¯èƒ½ enqueue æ–°çš„ computed/effect"]
  J --> K{"æœ‰æ–°å·¥ä½œ?ï¼ˆcomputeQ æˆ– effectQï¼‰"}
  K -- æ˜¯ --> C
  K -- å¦ --> Z

  H -- æ˜¯ --> Z

```

## Lesson 14: Topological

é¡å¤–è£œå……å…§å®¹ï¼Œä¹Ÿå¯ä»¥è€ƒæ…®æ¡ç”¨ "æ‹“æ¨¸æ’åº+å„ªå…ˆç´š" çš„æ–¹å¼ä¾†è™•ç†ï¼Œé€™äº›æ¯”è¼ƒé€²éšï¼Œæœƒç‰½æ¶‰åˆ° Graph ç®—æ³•çš„æ‡‰ç”¨ã€‚

### Topological flow chart

```mermaid
flowchart TD

A["é–‹å§‹ flushJobsTopo()"] --> B{allJobs ç‚ºç©º?}
B -- æ˜¯ --> Z[ç›´æ¥ return]
B -- å¦ --> C[åˆå§‹åŒ– indegree = 0]
C --> D[æƒææ¯å€‹ job.dependsOn<br/>å°æ‡‰çš„ä¸Šæ¸¸ job<br/>è¨ˆç®— indegree+1]
D --> E[å»ºç«‹ ready é›†åˆ<br/>æŒ‘ indegree = 0 çš„ job<br/>æ”¾é€² min-heap]

E --> F{heap ç‚ºç©º?}
F -- æ˜¯ä¸” allJobs ç©º --> Z
F -- æ˜¯ä½† allJobs é‚„æœ‰ --> Y[å¯èƒ½æœ‰å¾ªç’° â†’ fallback åŸ·è¡Œæ‰€æœ‰ job]
F -- å¦ --> G[å¾ heap pop å‡º<br/>priority æœ€å°çš„ job]
G --> H["åŸ·è¡Œ job.run()"]
H --> I[å¾ allJobs ç§»é™¤ job]
I --> J[å°æ‰€æœ‰ä¾è³´é€™å€‹ job çš„ä¸‹æ¸¸ indegree -1<br/>è‹¥è®Šæˆ 0 â†’ push heap]
J --> F

```

## Topological vs Two-phase flush

### æ‹“æ¨¸æ’åºï¼ˆTopological sortï¼‰

- å„ªé»ï¼š
  - åœ¨éœæ…‹ä¾è³´åœ–ä¸‹æœ€å„ªï¼Œå› ç‚ºèƒ½ä¸€æ¬¡æ’åºå¾Œã€Œä¹¾æ·¨ä¿è½ã€åœ°æŠŠæ›´æ–° propagate å®Œã€‚
  - é©åˆ spreadsheetã€build system é€™ç¨®ã€Œä¾è³´å›ºå®šã€çš„å ´æ™¯ã€‚
- ç¼ºé»ï¼š
  - ä¸€æ—¦ä¾è³´æœƒè®Šï¼ˆå‹•æ…‹ graphï¼‰ï¼Œæ‹“æ¨¸æ’åºéœ€è¦é »ç¹é‡å»ºæˆ–æœƒèª¤ç®—ï¼ˆæ¨™è¨˜äº†ä½†å…¶å¯¦ä¸ç”¨ï¼‰ã€‚
  - åœ¨ reactive æ¡†æ¶ï¼ˆSolidã€Vueã€MobXï¼‰è£¡ï¼Œæ¢ä»¶ä¾è³´ / lazy memo å¾ˆå¸¸è¦‹ï¼Œæ‹“æ¨¸å°±ä¸å†ç¸½æ˜¯æœ€å„ªã€‚

### å…©æ­¥é©Ÿ flushï¼ˆmark dirty â†’ flush jobsï¼‰

- å„ªé»ï¼š
  - å®¹å¿å‹•æ…‹ä¾è³´ï¼Œæ¯æ¬¡æ ¹æ“šã€Œå¯¦éš›è¨ªå•çš„ signalã€å»æ±ºå®šä¾è³´é—œä¿‚ã€‚
  - æ­é… lazy / equals checkï¼Œå°±èƒ½æŠŠã€Œèª¤ç®—ã€é™åˆ°æœ€å°ã€‚
- ç¼ºé»ï¼š
  - æœ‰æ™‚æœƒçœ‹èµ·ä¾†ã€Œå¤šæ¨™äº†ã€å†éæ¿¾æ‰ã€ï¼Œä¼¼ä¹æµªè²»ï¼Œä½†æ¯”èµ·é‡å»ºæ‹“æ¨¸é‚„æ˜¯åˆ’ç®—ã€‚
  - æœ¬è³ªä¸Šä¸æ˜¯ç†è«–æœ€å„ªï¼Œè€Œæ˜¯ã€Œå·¥ç¨‹ä¸Šæ›´ç©©å¥ã€çš„æŠ˜è¡·æ–¹æ¡ˆã€‚

### å…©è€…æ¯”è¼ƒè¡¨

| é¢å‘             | æ‹“æ¨¸æ’åº (Topological Sort)                  | å…©æ­¥é©Ÿ Flush (Mark â†’ Recompute)                  |
| ---------------- | :------------------------------------------- | :----------------------------------------------- |
| **é©ç”¨å ´æ™¯**     | éœæ…‹ä¾è³´åœ–ï¼ˆSpreadsheetã€Build Systemï¼‰      | å‹•æ…‹ä¾è³´åœ–ï¼ˆReactive Framework: Solid/Vue/MobXï¼‰ |
| **æ›´æ–°ç­–ç•¥**     | å…ˆæ’å¥½å…¨å±€é †åºï¼Œå†ä¾åº propagate             | å…ˆæ¨™è¨˜ã€Œé«’ã€ç¯€é»ï¼Œå†å¯¦éš›éœ€è¦æ™‚é‡ç®—               |
| **æ•ˆèƒ½**         | éœæ…‹ä¸‹æœ€å„ªï¼ŒO(V+E) å³å¯å®Œæˆ                  | å¯èƒ½å¤šä¸€æ¬¡æ¨™è¨˜ â†’ éæ¿¾ï¼Œä½†é¿å…äº†é‡å»ºæ‹“æ¨¸          |
| **å‹•æ…‹ä¾è³´è™•ç†** | éœ€è¦é‡å»ºæ‹“æ¨¸æˆ–å†’é¢¨éšªèª¤ç®—                     | å¤©ç”Ÿå®¹å¿ï¼Œä¾è³´æ¯æ¬¡é‡ç®—æ™‚é‡æ–°æ”¶é›†                 |
| **å…¸å‹å•é¡Œ**     | åœ¨å‹•æ…‹ä¾è³´ä¸‹æœƒ **unnecessary recomputation** | åœ¨éœæ…‹ä¾è³´ä¸‹ã€Œçœ‹ä¼¼ã€æœ‰é»å†—é¤˜                     |
| **å·¥ç¨‹å–å‘**     | ç†è«–ä¸Šæœ€å„ª                                   | å·¥ç¨‹ä¸Šæ›´ç©©å¥ï¼Œèƒ½è™•ç†å„ç¨®ç‹€æ³                     |

### æµç¨‹åœ–å·®ç•°

#### æ‹“æ¨¸æ’åº (Topological Sort)

```mermaid
flowchart TD
  A[Signal æ›´æ–°] --> B[é‡å»º/ä½¿ç”¨æ‹“æ¨¸é †åº]
  B --> C[ä¾åºåŸ·è¡Œç¯€é»]
  C --> D[å…¨éƒ¨æ›´æ–°å®Œæˆ]

```

- ç‰¹é»ï¼šä¸€æ¬¡æ’åº â†’ å…¨éƒ¨è·‘å®Œã€‚
- é©åˆéœæ…‹ä¾è³´ï¼Œä½†åœ¨å‹•æ…‹ä¾è³´ä¸‹å¯èƒ½è·‘äº†å¤šé¤˜çš„ç¯€é»ã€‚

#### å…©æ­¥é©Ÿ Flush (Mark â†’ Recompute)

```mermaid
flowchart TD
  A[Signal æ›´æ–°] --> B[Mark: æ¨™è¨˜é«’ç¯€é»]
  B --> C[Flush: æŒ‘å‡ºéœ€è¦çš„ç¯€é»é‡ç®—]
  C --> D[å‹•æ…‹æ”¶é›†ä¾è³´]
  D --> E[åªæ›´æ–°å¿…è¦éƒ¨åˆ†]

```

- ç‰¹é»ï¼šå…ˆã€Œæ¨™è¨˜ã€å†ã€Œå¯¦ç®—ã€ï¼Œæ¯æ¬¡é‡ç®—æœƒé‡æ–°æ”¶é›†ä¾è³´ã€‚
- é©åˆå‹•æ…‹ä¾è³´ï¼Œé¿å…ä¸å¿…è¦çš„é‡ç®—ã€‚

### ç¸½çµ

1. éœæ…‹åœ– â†’ æ‹“æ¨¸æ’åºæœ€å„ª
2. å‹•æ…‹åœ– â†’ Flush æ›´ç©©å¥

> æ‰€ä»¥ç­”æ¡ˆä»ç„¶æ˜¯ï¼šIt's depends.
